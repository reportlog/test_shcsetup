#if 0
	shc Version 3.8.9b, Generic Script Compiler
	Copyright (c) 1994-2015 Francisco Rosales <frosal@fi.upm.es>

	./shc -e 31/12/2222 -r -f logCapturex 
#endif

static  char data [] = 
#define      date_z	11
#define      date	((&data[0]))
	"\134\170\210\363\172\213\371\335\067\331\350"
#define      xecc_z	15
#define      xecc	((&data[13]))
	"\161\152\344\146\172\110\116\300\256\205\256\071\004\007\244\372"
	"\353"
#define      chk2_z	19
#define      chk2	((&data[29]))
	"\375\205\220\135\063\312\366\154\111\136\132\255\104\157\115\153"
	"\300\307\154\153\170\157\333"
#define      lsto_z	1
#define      lsto	((&data[51]))
	"\057"
#define      shll_z	8
#define      shll	((&data[54]))
	"\061\272\244\043\366\016\243\241\264\053\356"
#define      msg2_z	19
#define      msg2	((&data[67]))
	"\035\362\201\076\365\376\127\117\167\244\173\310\050\167\034\130"
	"\146\226\233\135\165\355\077\037\271\155"
#define      tst1_z	22
#define      tst1	((&data[91]))
	"\365\322\111\372\210\172\135\216\066\162\221\034\205\200\300\034"
	"\013\275\057\005\241\060\276\257\254\077\226\252"
#define      rlax_z	1
#define      rlax	((&data[117]))
	"\027"
#define      inlo_z	3
#define      inlo	((&data[118]))
	"\212\230\344"
#define      chk1_z	22
#define      chk1	((&data[126]))
	"\176\260\026\034\220\200\273\207\035\254\350\202\160\043\172\327"
	"\170\030\102\101\365\007\012\167\042\206\217"
#define      opts_z	1
#define      opts	((&data[148]))
	"\347"
#define      text_z	2347
#define      text	((&data[424]))
	"\363\345\046\133\222\034\056\077\134\304\351\024\312\157\067\352"
	"\102\203\337\152\002\220\201\036\040\072\127\244\164\317\106\150"
	"\265\155\303\110\212\362\210\346\267\162\373\201\341\062\153\044"
	"\266\113\217\270\334\021\326\375\113\056\241\300\376\347\050\264"
	"\125\354\375\337\336\205\306\225\367\301\026\331\363\202\376\252"
	"\316\215\143\252\236\072\247\352\150\111\252\147\061\323\034\206"
	"\277\031\146\235\236\054\062\226\355\111\157\341\313\156\213\232"
	"\373\356\105\232\050\355\204\221\066\057\371\147\002\025\355\301"
	"\056\124\136\314\200\221\143\155\332\323\116\246\101\332\100\074"
	"\311\206\327\362\163\134\204\251\213\175\020\216\222\376\117\300"
	"\122\256\215\322\100\361\100\032\304\217\301\005\152\002\102\063"
	"\210\031\046\373\165\252\244\001\047\265\217\271\264\337\172\006"
	"\216\010\331\316\371\032\351\275\251\252\303\023\255\005\107\065"
	"\037\155\061\224\027\326\226\077\213\045\370\077\004\163\106\222"
	"\173\040\141\165\072\112\062\343\364\365\367\241\373\077\327\032"
	"\254\010\257\304\336\105\003\152\153\374\252\160\157\361\003\353"
	"\021\144\140\114\256\223\060\243\211\047\105\204\146\035\237\023"
	"\046\117\327\151\303\077\142\204\275\310\363\133\046\206\207\302"
	"\151\043\373\253\041\143\112\166\112\236\236\370\333\014\341\251"
	"\123\072\047\010\056\231\126\100\100\134\346\141\334\025\276\027"
	"\274\002\171\171\123\377\107\147\036\147\342\031\331\050\346\320"
	"\142\364\172\164\165\172\062\204\314\201\260\050\044\071\363\307"
	"\024\172\244\220\021\353\164\114\373\315\365\246\137\220\264\011"
	"\316\313\222\351\216\313\146\103\222\214\252\116\033\366\272\155"
	"\325\253\274\037\365\212\261\222\157\067\047\201\174\242\025\351"
	"\206\263\170\254\255\236\150\063\160\357\130\164\034\307\227\241"
	"\243\275\275\314\130\120\317\370\212\355\070\120\317\043\243\247"
	"\127\331\150\362\112\023\306\006\266\022\351\142\337\252\053\322"
	"\370\230\363\122\057\350\103\273\374\137\027\150\203\352\207\266"
	"\076\216\377\250\364\154\263\261\315\341\343\237\346\060\203\263"
	"\015\050\052\151\312\312\122\005\017\370\220\245\126\042\154\253"
	"\033\022\015\013\051\130\132\274\356\230\352\305\117\333\136\050"
	"\042\040\302\352\157\114\132\230\015\312\122\245\252\324\074\312"
	"\151\130\134\365\047\156\114\315\231\177\017\261\151\372\162\044"
	"\007\363\127\104\172\200\247\243\234\164\071\027\147\363\275\153"
	"\227\340\357\051\316\041\072\037\236\025\000\255\103\145\244\041"
	"\321\071\147\244\003\025\213\021\203\055\326\267\364\055\174\303"
	"\373\167\200\023\223\275\245\126\062\106\175\113\122\011\236\277"
	"\167\303\332\141\214\114\103\374\235\023\372\160\366\362\315\372"
	"\276\270\305\001\343\306\261\041\171\260\020\253\245\132\337\364"
	"\220\026\355\214\011\324\126\305\063\272\262\116\043\322\244\001"
	"\236\017\254\132\224\355\301\330\026\117\161\335\023\325\216\146"
	"\216\315\277\227\102\261\374\307\157\107\230\146\226\362\266\045"
	"\313\165\222\026\025\352\101\121\044\061\102\325\365\327\041\227"
	"\123\036\011\311\114\152\035\274\047\043\176\132\271\172\360\302"
	"\250\150\214\353\327\150\212\053\154\343\356\063\035\157\145\066"
	"\042\214\137\263\343\136\225\027\113\113\130\111\064\245\341\002"
	"\266\163\021\136\063\355\270\376\020\250\254\174\010\146\050\337"
	"\344\154\333\326\244\124\116\370\236\044\147\306\322\270\044\325"
	"\021\242\264\135\117\162\305\310\342\022\343\273\326\140\271\375"
	"\237\253\240\251\000\137\136\116\121\377\373\131\336\203\114\071"
	"\110\253\232\232\247\272\177\265\351\343\235\212\162\051\327\327"
	"\144\206\117\253\105\033\130\131\011\253\015\224\133\234\263\064"
	"\012\023\164\367\075\051\102\063\235\237\345\302\267\374\017\032"
	"\271\251\363\150\037\267\317\015\010\047\315\037\205\010\256\060"
	"\150\135\100\160\260\372\202\226\255\070\343\021\225\276\160\037"
	"\050\130\166\152\165\337\242\246\124\011\047\350\015\375\027\175"
	"\111\207\154\332\265\063\274\302\067\073\306\146\022\040\171\057"
	"\316\041\256\104\343\167\036\200\250\155\151\026\242\112\277\315"
	"\155\242\257\055\124\127\340\262\211\344\210\314\130\355\255\006"
	"\136\123\210\361\336\215\113\132\203\006\165\110\307\257\035\070"
	"\314\203\171\246\150\300\017\234\047\120\022\232\336\016\136\217"
	"\325\024\137\047\207\053\050\042\253\207\061\231\075\167\312\111"
	"\041\371\010\204\011\177\057\173\320\024\207\206\001\326\067\033"
	"\001\143\173\304\037\327\100\060\164\275\345\235\170\311\002\350"
	"\043\231\126\053\120\370\321\333\371\142\135\143\052\061\226\271"
	"\272\305\304\374\067\215\045\331\137\364\070\337\052\263\200\226"
	"\005\127\247\106\075\300\026\070\171\377\241\147\247\335\001\315"
	"\137\063\065\243\246\001\365\313\263\161\337\270\203\157\151\112"
	"\070\244\135\002\101\175\352\300\217\251\231\141\164\235\126\211"
	"\237\336\314\124\115\202\212\331\025\046\025\265\163\351\364\121"
	"\327\326\345\163\357\167\042\060\275\116\317\141\145\240\127\076"
	"\107\210\145\230\366\167\035\203\011\266\365\014\363\246\373\277"
	"\304\024\130\244\332\137\024\346\374\247\212\060\232\377\236\135"
	"\220\057\065\141\376\367\131\323\251\353\324\177\046\020\147\116"
	"\172\265\273\376\001\172\253\061\226\105\016\246\207\333\245\045"
	"\302\223\133\161\335\136\266\060\204\250\064\331\204\006\003\254"
	"\155\242\166\362\275\257\207\065\332\301\002\272\062\161\147\117"
	"\263\375\144\000\254\101\112\162\126\011\214\230\013\075\343\041"
	"\030\313\224\130\264\065\332\165\244\134\075\265\304\221\375\125"
	"\170\241\217\073\334\310\377\203\346\307\231\217\373\244\153\360"
	"\032\340\245\022\137\052\023\122\163\224\303\250\034\223\076\175"
	"\161\022\274\310\207\067\264\063\077\174\174\273\020\226\021\272"
	"\230\272\034\062\251\000\314\022\270\232\206\257\017\242\202\321"
	"\173\372\114\325\136\237\264\012\140\171\272\040\322\347\063\174"
	"\373\324\220\327\275\004\073\240\331\316\255\140\005\372\071\060"
	"\364\345\007\212\210\221\224\077\227\233\324\016\244\327\246\031"
	"\271\135\304\374\126\155\064\371\102\133\100\307\112\147\316\145"
	"\212\354\261\172\322\301\161\331\367\315\350\223\271\301\006\023"
	"\072\263\046\000\160\243\337\101\257\202\235\056\234\164\337\156"
	"\346\106\077\326\107\325\337\014\340\244\126\375\352\031\143\136"
	"\067\332\207\313\077\366\360\376\332\041\037\301\005\062\270\135"
	"\172\271\351\147\210\370\377\066\152\121\335\130\361\371\021\241"
	"\373\333\101\052\246\106\165\314\377\263\240\023\132\154\204\037"
	"\130\250\042\000\256\036\357\075\144\251\225\366\164\227\244\004"
	"\241\132\327\127\233\345\171\014\166\306\324\023\360\036\020\177"
	"\355\113\306\317\214\270\365\167\037\366\322\076\304\233\345\260"
	"\133\362\115\304\234\241\073\273\212\272\300\337\076\114\342\135"
	"\205\356\333\367\361\264\126\063\051\142\042\103\335\220\311\237"
	"\271\107\330\022\232\163\173\104\260\071\271\155\210\200\155\324"
	"\205\054\135\361\170\234\370\303\071\230\062\100\253\361\050\150"
	"\246\376\265\036\003\062\332\307\171\271\232\335\243\136\200\243"
	"\034\162\264\213\167\224\144\315\232\210\254\157\036\255\104\342"
	"\362\351\373\217\355\254\120\350\316\121\315\377\377\014\264\254"
	"\105\142\043\237\211\133\206\306\212\371\157\217\121\103\154\074"
	"\324\244\313\210\045\305\373\264\136\206\103\314\016\374\011\025"
	"\220\056\345\102\074\167\223\327\065\102\023\040\222\012\226\263"
	"\346\010\120\024\120\006\120\236\364\271\346\200\141\261\146\066"
	"\156\333\052\021\011\132\213\264\261\335\072\114\215\353\014\261"
	"\044\171\114\054\143\212\332\043\304\177\343\015\126\037\123\052"
	"\107\213\105\131\360\324\016\307\254\142\172\160\023\153\136\063"
	"\126\260\223\177\216\155\201\325\052\017\274\177\035\047\220\174"
	"\053\050\243\031\301\124\060\123\120\067\320\072\352\364\122\305"
	"\136\320\045\025\104\006\137\226\331\311\074\036\212\231\363\153"
	"\302\106\255\055\016\120\001\150\212\025\240\004\255\335\271\040"
	"\152\026\257\023\125\222\300\072\336\076\352\011\035\110\103\160"
	"\126\303\042\367\265\377\146\361\274\060\235\364\053\222\235\350"
	"\140\335\205\045\072\066\111\347\223\037\104\033\242\074\031\052"
	"\213\333\173\051\255\063\224\146\001\231\241\045\365\234\353\361"
	"\266\172\011\151\232\042\010\372\200\171\200\273\273\035\302\373"
	"\222\367\252\142\344\246\055\260\366\006\003\115\165\074\154\252"
	"\331\103\023\015\064\341\134\100\235\143\113\153\010\317\223\150"
	"\254\123\037\251\031\220\216\236\221\244\217\371\127\275\104\352"
	"\010\054\171\342\307\065\062\032\200\336\230\314\316\150\170\111"
	"\175\077\176\245\232\213\317\315\377\065\055\116\132\114\151\204"
	"\311\226\172\130\015\165\056\050\250\053\242\323\137\143\226\172"
	"\272\314\263\042\355\374\016\145\032\311\100\062\151\326\330\112"
	"\344\044\030\376\136\011\354\371\047\027\010\055\175\305\301\212"
	"\320\237\116\124\100\020\336\375\124\101\100\124\107\212\176\067"
	"\345\137\343\033\005\175\374\177\220\175\134\042\071\325\205\044"
	"\225\064\013\302\027\135\200\232\263\311\023\337\064\061\243\166"
	"\136\056\123\040\102\351\172\330\265\213\113\206\104\103\260\012"
	"\313\201\002\222\014\123\145\015\007\344\153\265\037\055\070\064"
	"\070\000\332\020\357\326\064\053\027\066\210\136\321\267\077\105"
	"\255\223\220\305\000\201\315\117\236\376\313\075\061\243\255\173"
	"\277\347\135\026\232\115\265\262\072\303\302\004\372\033\213\254"
	"\133\132\107\065\067\236\263\377\002\123\353\303\155\367\173\215"
	"\224\137\135\044\211\110\023\126\134\007\212\245\101\266\262\312"
	"\306\145\003\104\042\350\242\133\207\027\235\012\050\301\322\304"
	"\275\260\023\317\023\224\141\263\047\236\347\135\366\176\314\354"
	"\251\070\067\053\272\304\036\175\210\104\331\017\250\372\370\372"
	"\346\173\154\350\373\311\276\010\172\067\363\266\142\004\144\274"
	"\035\365\132\210\044\151\033\320\105\046\133\171\211\267\014\247"
	"\265\034\323\363\351\303\142\250\047\162\247\271\104\254\231\244"
	"\262\171\156\050\223\114\045\267\054\111\167\152\312\303\176\303"
	"\215\174\261\050\343\335\321\204\120\036\375\216\033\361\353\157"
	"\123\115\075\242\312\004\006\035\075\324\251\114\021\143\130\047"
	"\156\047\055\351\266\345\011\311\227\304\234\351\051\147\024\302"
	"\062\173\276\171\205\066\261\035\163\122\304\260\363\370\063\300"
	"\025\302\111\226\332\146\160\367\032\224\112\261\302\136\344\063"
	"\034\117\302\140\324\050\016\376\126\204\274\000\310\100\152\257"
	"\251\206\223\013\040\227\234\225\343\065\372\074\251\157\325\040"
	"\273\325\205\103\245\016\106\130\153\362\137\040\035\041\243\310"
	"\243\357\313\060\323\167\306\110\172\043\111\302\165\245\130\366"
	"\322\044\147\324\272\075\222\365\031\061\015\046\014\061\370\365"
	"\334\123\015\213\113\025\230\310\241\250\303\014\232\135\151\003"
	"\277\262\372\035\303\114\227\266\353\044\267\074\227\110\155\261"
	"\363\201\276\264\177\257\335\222\072\161\237\073\100\002\222\250"
	"\216\226\247\027\155\332\101\146\110\343\230\325\023\117\111\170"
	"\145\061\327\007\324\325\055\146\047\063\322\075\302\070\326\126"
	"\016\035\366\326\274\051\116\152\206\371\150\260\215\326\041\212"
	"\147\224\070\044\076\033\101\245\021\166\316\052\301\315\361\211"
	"\355\173\030\114\235\036\114\030\355\071\332\213\214\140\175\367"
	"\246\164\043\226\016\044\074\274\262\266\365\345\034\343\004\225"
	"\333\157\001\327\031\161\107\013\164\062\034\331\223\150\210\046"
	"\230\053\260\300\161\065\047\217\324\073\265\044\023\271\271\356"
	"\051\272\306\103\054\015\116\241\100\152\172\323\323\002\372\154"
	"\056\252\055\237\337\125\056\264\220\343\331\243\235\223\222\307"
	"\116\130\012\172\145\130\033\245\303\225\171\227\227\163\003\305"
	"\036\061\145\375\206\224\262\026\170\213\272\026\037\114\335\155"
	"\244\347\350\011\077\003\257\003\231\050\232\061\234\235\367\272"
	"\316\135\267\125\361\152\153\152\366\045\200\025\162\135\203\026"
	"\105\153\040\204\157\317\207\010\370\041\072\224\277\061\116\216"
	"\217\006\343\200\160\117\353\147\165\153\175\347\311\000\375\016"
	"\153\035\222\333\355\032\343\345\074\036\171\374\120\307\212\337"
	"\316\156\140\076\275\113\246\063\266\043\032\177\043\030\215\217"
	"\066\040\152\043\073\116\011\167\154\202\163\274\112\376\233\030"
	"\154\374\127\052\107\376\135\375\041\167\175\105\220\013\325\306"
	"\053\100\352\146\216\363\336\373\166\122\270\300\120\124\331\274"
	"\120\061\347\227\057\104\225\121\274\022\226\114\036\154\023\111"
	"\254\375\260\073\360\216\066\147\340\356\050\061\103\001\356\223"
	"\063\325\052\142\031\300\264\325\322\113\042\360\267\065\072\144"
	"\062\353\237\043\172\326\212\132\304\262\214\010\264\172\233\347"
	"\117\305\112\150\206\376\076\130\111\140\111\001\225\204\145\310"
	"\157\004\353\351\332\165\104\237\050\320\247\334\113\102\303\232"
	"\010\016\003\216\014\101\347\126\241\061\130\067\266\275\377\046"
	"\302\353\020\234\141\124\074\211\045\344\145\161\047\051\013\060"
	"\067\016"
#define      tst2_z	19
#define      tst2	((&data[3144]))
	"\246\027\161\175\234\055\267\054\106\146\376\117\270\210\246\234"
	"\050\126\062\372\233"
#define      pswd_z	256
#define      pswd	((&data[3219]))
	"\051\217\261\051\265\163\024\305\017\166\032\114\377\100\060\145"
	"\261\127\217\274\207\307\312\106\014\032\355\250\014\305\233\065"
	"\125\114\137\012\277\163\317\317\352\351\033\351\051\114\117\332"
	"\243\337\227\052\246\142\160\073\030\004\015\320\372\076\276\273"
	"\005\347\260\274\230\121\245\070\273\236\360\065\203\137\243\011"
	"\075\040\006\102\136\352\176\167\357\214\107\352\312\006\246\320"
	"\355\126\214\205\247\061\276\143\320\257\231\123\017\074\135\115"
	"\135\143\220\273\116\016\063\076\233\172\050\145\200\316\065\156"
	"\045\301\364\315\363\262\060\304\142\312\027\161\007\165\276\144"
	"\330\116\040\047\135\123\146\370\315\217\135\116\135\223\274\203"
	"\125\261\121\110\144\202\014\306\114\044\067\123\231\366\267\162"
	"\105\327\232\242\052\000\233\370\217\371\106\355\214\003\161\341"
	"\264\302\052\030\104\067\337\220\134\027\344\365\015\233\150\122"
	"\163\002\365\235\003\220\226\222\211\334\200\026\340\362\367\224"
	"\264\042\255\370\131\215\211\265\244\155\253\261\011\023\004\174"
	"\025\371\032\031\211\260\254\023\215\054\051\155\036\041\002\323"
	"\103\257\314\235\075\125\123\341\303\376\222\314\022\227\111\047"
	"\220\143\101\032\023\355\055\241\031\126\016\070\167\020\014\273"
	"\300\330\130\375\056\253\336\362\252\161\276\274\010\010\344\230"
	"\153\045\263\177\022\340\040\263\175\136\133\211\044\367\277\171"
	"\103\036\203\003\222\123\323\174\074\357\146\146\073\266\101\336"
	"\225\331\011\074\073\172\357\270\330\113\102\374\102\001\165\205"
	"\040\370\211\262\113\135\057\210\114\225\357\207\113\061\146\341"
	"\012\157\035\105"
#define      msg1_z	42
#define      msg1	((&data[3536]))
	"\271\302\230\156\130\127\263\016\377\375\144\135\207\166\233\227"
	"\006\336\126\111\174\326\171\113\006\144\056\025\272\112\353\205"
	"\261\337\354\336\143\260\223\005\076\055\301\130\100\276\232\101"
	"\063\040\141\054"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
