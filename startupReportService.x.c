#if 0
	shc Version 3.8.9b, Generic Script Compiler
	Copyright (c) 1994-2015 Francisco Rosales <frosal@fi.upm.es>

	./shc -f startupReportService 
#endif

static  char data [] = 
#define      date_z	1
#define      date	((&data[0]))
	"\322"
#define      chk2_z	19
#define      chk2	((&data[3]))
	"\373\155\216\160\135\025\066\377\126\244\234\123\036\001\064\332"
	"\376\054\101\023\146\154\233"
#define      tst2_z	19
#define      tst2	((&data[25]))
	"\276\174\161\144\001\006\133\031\064\277\252\112\156\073\002\064"
	"\260\042\204\174"
#define      chk1_z	22
#define      chk1	((&data[45]))
	"\276\357\004\035\311\323\346\225\045\006\234\133\066\144\310\226"
	"\001\000\302\256\011\366\147\332\012\162"
#define      pswd_z	256
#define      pswd	((&data[131]))
	"\015\334\376\364\124\030\141\200\104\241\164\327\061\160\104\236"
	"\013\043\333\031\342\146\112\154\044\045\166\226\033\147\315\050"
	"\104\313\035\231\344\176\032\050\040\217\377\122\377\104\360\013"
	"\150\314\045\112\062\157\266\127\224\055\356\257\225\353\255\047"
	"\071\201\040\124\117\347\375\003\376\247\122\162\026\051\371\127"
	"\324\116\105\302\162\033\044\055\072\070\303\356\043\161\026\134"
	"\362\067\260\101\036\256\105\035\126\227\217\155\300\210\304\224"
	"\327\011\127\112\045\174\170\140\264\074\116\327\255\145\064\237"
	"\234\345\341\273\224\046\330\353\275\147\130\175\360\035\022\310"
	"\047\151\023\115\345\213\255\232\310\374\161\165\141\246\025\375"
	"\213\366\270\040\034\221\013\331\371\143\127\352\201\151\263\250"
	"\323\306\365\271\122\243\123\032\237\305\217\000\153\245\376\367"
	"\233\267\027\267\111\043\221\102\207\350\054\010\121\337\261\044"
	"\245\247\336\370\112\061\022\352\366\242\353\142\107\351\132\342"
	"\241\162\231\352\225\053\054\034\023\131\045\145\070\326\212\336"
	"\175\150\326\310\231\351\262\220\213\235\363\323\207\115\265\050"
	"\300\117\022\125\172\077\162\215\230\227\363\321\156\175\260\353"
	"\345\207\264\177\160\146\020\374\004\003\317\214\121\205\264\021"
	"\324\307\147\116\007\331\334\240\161\320\162\337\115\042\313\063"
	"\252\200\263\033\347\304\027\353\310\347\167\031\154\273\330\332"
	"\206\365\163\152\164\215\223\225\034\223"
#define      msg1_z	42
#define      msg1	((&data[401]))
	"\330\225\032\132\203\123\243\377\321\047\303\225\241\057\141\050"
	"\116\047\346\103\252\143\373\273\325\036\211\361\201\066\252\154"
	"\150\073\332\305\262\042\052\314\262\155\157\047\100\244\114\212"
	"\327\274\101\056"
#define      inlo_z	3
#define      inlo	((&data[452]))
	"\307\270\222"
#define      shll_z	8
#define      shll	((&data[455]))
	"\032\221\121\026\353\025\073\241\330\336"
#define      xecc_z	15
#define      xecc	((&data[468]))
	"\311\102\337\156\362\222\301\163\346\075\174\072\373\111\103\271"
	"\161\252\135"
#define      text_z	1100
#define      text	((&data[756]))
	"\276\031\310\227\101\010\074\216\223\023\112\325\102\233\104\137"
	"\233\111\067\163\050\226\101\172\140\203\132\275\132\127\255\031"
	"\160\165\260\261\176\354\100\021\000\212\347\102\045\054\242\300"
	"\166\331\063\236\160\165\031\321\370\164\216\122\313\074\153\074"
	"\262\033\356\060\010\056\102\010\270\051\113\336\126\355\237\314"
	"\307\323\152\070\110\203\011\100\370\227\222\303\324\376\377\206"
	"\032\356\267\043\034\371\053\325\043\167\263\171\144\122\105\054"
	"\045\257\144\155\063\155\256\053\005\101\357\332\077\357\140\132"
	"\335\027\175\372\021\251\317\064\040\203\255\204\326\363\261\373"
	"\243\026\151\327\204\030\002\211\131\362\144\231\341\304\363\277"
	"\334\161\271\355\032\210\041\072\014\317\277\342\302\160\336\145"
	"\206\107\074\012\137\077\224\271\062\370\122\024\275\106\323\231"
	"\267\214\207\321\025\251\013\042\170\312\004\073\073\342\241\301"
	"\052\335\314\212\035\141\103\117\132\225\143\027\333\067\261\222"
	"\304\071\143\332\342\157\374\132\071\000\226\164\342\067\066\015"
	"\025\003\227\062\144\332\202\277\160\346\327\113\035\210\336\341"
	"\302\102\273\244\261\270\377\353\270\225\140\233\314\227\250\342"
	"\060\005\044\276\027\276\307\055\171\045\255\224\240\247\024\352"
	"\265\337\212\315\363\127\164\353\003\352\232\150\100\322\143\147"
	"\252\304\034\224\164\156\031\013\160\350\151\203\270\245\045\304"
	"\033\213\207\073\120\130\336\255\115\130\224\037\014\124\003\014"
	"\231\141\027\023\274\006\253\336\276\353\071\222\132\056\262\014"
	"\231\112\213\273\066\172\106\224\235\101\171\212\074\243\304\336"
	"\336\265\125\107\106\076\342\372\235\010\143\037\336\234\243\016"
	"\060\315\163\277\107\143\071\114\237\141\273\312\013\377\062\374"
	"\066\063\005\064\253\267\051\265\154\041\172\205\252\026\020\360"
	"\266\146\210\031\255\350\147\026\146\050\071\104\334\265\035\312"
	"\213\115\330\011\141\113\361\042\044\160\345\156\320\057\352\073"
	"\073\123\217\142\145\013\340\037\011\014\125\123\324\377\057\004"
	"\145\066\011\317\107\302\160\033\320\240\362\166\255\015\221\340"
	"\206\146\156\016\045\250\324\153\074\144\253\150\353\130\027\060"
	"\100\041\051\216\324\262\106\074\117\151\335\252\077\005\143\121"
	"\032\015\270\126\301\213\324\036\147\024\174\362\352\146\004\027"
	"\206\145\145\217\056\057\170\231\020\346\001\154\323\004\300\126"
	"\151\256\120\304\222\351\301\167\362\247\156\307\173\273\272\324"
	"\253\006\224\355\123\245\341\322\263\175\026\103\117\205\126\162"
	"\111\071\211\103\055\244\204\303\337\253\135\342\207\366\040\104"
	"\020\145\373\064\310\141\327\021\120\231\340\022\320\274\140\273"
	"\173\140\223\343\105\057\321\315\156\363\003\074\277\255\177\053"
	"\366\020\220\172\323\110\057\013\216\123\246\021\046\301\306\235"
	"\033\317\253\251\055\223\014\357\150\212\166\377\025\211\050\362"
	"\317\031\204\171\027\267\110\244\325\276\011\104\172\262\177\007"
	"\355\276\374\143\110\032\065\373\307\062\206\251\360\120\201\353"
	"\035\231\356\317\344\064\210\027\030\235\317\025\156\051\236\370"
	"\044\071\332\357\257\215\005\122\201\327\365\125\022\201\174\060"
	"\053\345\045\362\354\352\142\315\271\171\023\256\164\325\203\016"
	"\043\217\176\311\035\367\331\351\055\002\204\110\162\155\017\171"
	"\333\035\077\356\010\130\370\341\077\271\000\361\127\026\215\336"
	"\205\374\021\002\011\122\240\131\163\251\147\271\323\035\220\274"
	"\223\055\366\067\035\017\341\275\257\306\172\376\175\230\034\313"
	"\342\166\212\026\072\131\375\161\256\131\065\322\220\244\112\025"
	"\204\161\163\201\052\046\003\310\364\170\335\027\115\046\115\273"
	"\253\256\231\140\110\023\012\127\100\321\176\101\007\135\260\272"
	"\120\270\026\215\105\344\365\061\163\277\302\121\344\250\230\331"
	"\114\053\126\156\151\207\322\041\112\261\062\356\377\223\257\024"
	"\066\174\117\362\127\156\057\100\032\372\060\174\350\241\346\341"
	"\275\227\275\012\257\232\003\172\055\265\226\365\320\011\335\145"
	"\165\155\254\074\244\321\271\007\342\123\346\015\327\117\313\262"
	"\254\107\342\173\302\245\050\276\015\010\325\332\335\270\017\175"
	"\042\304\060\147\035\210\003\143\231\027\045\016\144\173\170\052"
	"\064\273\043\054\134\370\223\170\374\144\300\220\207\312\306\266"
	"\024\027\255\053\274\166\310\334\056\234\334\114\223\345\225\067"
	"\150\104\262\023\320\165\016\123\205\131\113\075\074\173\144\237"
	"\170\121\042\200\312\043\072\165\367\247\321\202\040\105\170\116"
	"\264\334\006\243\327\147\024\140\065\376\273\130\206\324\107\317"
	"\221\074\237\205\250\235\347\106\264\267\225\277\053\142\042\041"
	"\376\211\143\257\264\073\161\366\174\333\277\073\127\302\155\061"
	"\002\355\024\230\277\176\231\336\364\166\072\126\343\020\235\262"
	"\073\051\344\342\172\121\327\273\323\032\125\361\336\177\073\231"
	"\071\157\350\345\352\160\272\137\256\053\303\211\246\263\207\061"
	"\045\011\115\311\337\356\015\212\265\272\361\075\272\306\040\122"
	"\171\057\103\055\044\203\071\375\372\366\012\032\366\162\367\115"
	"\004\122\203\361\234\203\036\371\170\276\024\225\041\050\265\172"
	"\351\040\037\315\153\041\066\165\007\172\076\233\017\277\314\341"
	"\131\033\377\312\005\216\301\125\073\145\306\241\234\145\144\235"
	"\171\101\221\045\312\367\136\036\324\005\357\334\326\021\260\360"
	"\361\166\015\225\376\356\121\271\125\122\350\115\350\072\061\006"
	"\036\000\075\165\060\077\157\335\142\062\213\356\374\233\371\156"
	"\040\053\023\203\061\342\041\326\104\243\326\300\203\314\140\071"
	"\345\320\004\345\143\137\261\070\210\121\311\253\002\057\346\011"
	"\215\122\207\100\122\251\014\364\222\344\161\061\056\101\215\027"
	"\126\171\132\175\325\355\242\335\131\103\277\347\345\311\351\156"
	"\346\121\304\135\351\346\170\037\203\163\357\355\266\004\077\031"
	"\336\215\303\337\325\015\207\154\213\350\377\020\253\146\131\355"
	"\324\030\032\251\315\265\232\044\162\376\021\210\322\374\257\312"
	"\041\303\101\153\227\256\151\101\214\025\102\060\232\077\025\377"
	"\032\227\276\212\175\225\325\233\036\264\175\340\366\071\205\250"
	"\361\204\223\252\032\363\105\347\212\356\311\045\056\336\044\110"
	"\165\343\322\363\170\250\217\227\134\014\170\123\105\375\373\066"
	"\202\217\341\234\202\047\203\015\025\114\062\104\052\127\214\240"
	"\072\137\224\263\007\043\112\144\057\303\270\165\301\264\254\103"
	"\103\215\337\306\264\143\323\311\257\006\016\332\135\232\173\230"
	"\372\020\113\002\063\226\146\143\132\037\330\033\323\204\136\026"
	"\021\076\334\305\242\260\217\122\266\235\054\024\070\250\254\062"
	"\270\370\064\354\217\233\117\351\273\050\004\216\254\143\244\276"
	"\242\201\204\104\061\024\226\350\261\303\375\352\153\251\035\044"
	"\242\121\020\061\355\140\032\250\210\037\067\065\202\333\363\045"
	"\135\170\152\216\214\000\167\076\303\164\050\057\036\105\124\300"
	"\227\145\362\205\306\015\055\116\054\144\204\257\100\170\325\235"
	"\360\077\054\174\077\244\272\003\030\343\063\066\050\210\367\300"
	"\355\352\105\263\367\162\002\043\327\206\323\030\376\250\266\357"
	"\347\342\153\047\206\046\052\237\011\136\325\062\346\315"
#define      lsto_z	1
#define      lsto	((&data[2114]))
	"\012"
#define      tst1_z	22
#define      tst1	((&data[2118]))
	"\252\211\322\164\273\067\063\156\057\111\051\165\115\361\010\140"
	"\075\303\105\047\253\336\072\141\176\201\020\246\232"
#define      msg2_z	19
#define      msg2	((&data[2145]))
	"\376\323\313\015\136\206\120\313\176\005\055\275\334\314\254\201"
	"\056\156\001\242\065"
#define      rlax_z	1
#define      rlax	((&data[2165]))
	"\036"
#define      opts_z	1
#define      opts	((&data[2166]))
	"\274"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
