#if 0
	shc Version 3.8.9b, Generic Script Compiler
	Copyright (c) 1994-2015 Francisco Rosales <frosal@fi.upm.es>

	./shc -f startupReportService 
#endif

static  char data [] = 
#define      chk2_z	19
#define      chk2	((&data[0]))
	"\354\206\234\227\152\024\034\356\367\044\073\043\133\375\356\151"
	"\026\302\044\043\235\142"
#define      rlax_z	1
#define      rlax	((&data[22]))
	"\160"
#define      inlo_z	3
#define      inlo	((&data[23]))
	"\071\362\141"
#define      shll_z	8
#define      shll	((&data[26]))
	"\170\027\062\207\357\071\366\271"
#define      tst1_z	22
#define      tst1	((&data[35]))
	"\213\116\265\300\305\370\115\370\144\343\020\040\121\123\212\037"
	"\345\120\221\327\250\202\321\143\011\357"
#define      xecc_z	15
#define      xecc	((&data[62]))
	"\171\373\024\247\124\363\322\264\154\113\265\172\303\322\007\042"
	"\240\324\045"
#define      msg2_z	19
#define      msg2	((&data[81]))
	"\253\131\161\132\053\113\115\105\060\356\360\056\255\052\134\114"
	"\152\364\204\102\354"
#define      lsto_z	1
#define      lsto	((&data[100]))
	"\151"
#define      pswd_z	256
#define      pswd	((&data[154]))
	"\076\032\346\161\117\002\355\242\244\170\006\256\150\075\153\351"
	"\266\146\276\334\014\122\373\267\253\076\377\150\070\323\137\166"
	"\355\106\350\074\110\325\337\355\115\345\233\266\043\006\240\332"
	"\155\136\267\171\261\027\201\137\337\337\176\156\023\317\033\311"
	"\136\021\162\015\315\106\333\002\372\011\221\106\173\037\360\150"
	"\131\001\220\072\030\022\231\367\361\030\146\005\350\201\316\107"
	"\223\101\124\141\210\060\143\202\071\364\311\264\024\271\035\155"
	"\273\255\247\324\300\101\314\261\131\062\267\102\263\205\211\107"
	"\307\336\250\117\016\014\321\110\000\232\375\024\123\032\201\017"
	"\310\051\343\210\153\257\072\305\341\361\007\225\167\221\335\076"
	"\157\206\215\176\222\136\307\223\371\304\247\115\337\051\134\250"
	"\123\100\061\276\357\153\203\321\135\212\146\325\034\103\023\213"
	"\312\241\011\134\000\320\357\371\225\227\107\164\301\243\034\024"
	"\343\116\323\323\272\126\244\027\341\013\354\375\117\000\211\031"
	"\241\223\166\241\144\146\233\371\375\342\156\277\206\213\324\152"
	"\331\247\076\223\376\342\253\340\355\230\336\075\230\150\126\072"
	"\373\314\334\137\062\167\131\060\132\310\360\341\123\304\113\055"
	"\154\212\301\153\154\154\114\132\005\052\227\235\222\356\330\216"
	"\273\264\356\356\054\110\037\206\020\017\147\144\324\263\221\101"
	"\075\122\254\252\277\263\061\134\361\060\305\051\004\044\240\362"
	"\152\210\057\263\135\017\240\253\365\074\141\030\103\002\363\260"
	"\140\252\052\021\135\133\156\117\214\063\171\221\130\031\203\303"
	"\241\262\166\377\302\027\252\267\124\014\317\227\016\303\110\156"
	"\156\162\200"
#define      opts_z	1
#define      opts	((&data[472]))
	"\217"
#define      msg1_z	42
#define      msg1	((&data[476]))
	"\225\354\173\120\004\377\314\132\200\131\026\263\233\327\354\026"
	"\324\256\145\021\224\307\303\226\003\247\330\365\235\314\331\057"
	"\271\111\341\004\257\123\217\135\324\052\217\374\247\256"
#define      chk1_z	22
#define      chk1	((&data[520]))
	"\042\121\362\066\072\103\243\270\124\353\370\361\066\035\312\315"
	"\114\261\222\255\261\276\345\265"
#define      text_z	1123
#define      text	((&data[793]))
	"\372\233\040\006\153\270\024\056\000\203\234\162\004\150\101\363"
	"\204\234\026\031\210\221\310\370\320\030\032\205\147\377\121\142"
	"\232\162\150\006\053\175\065\053\000\322\236\005\073\340\371\300"
	"\174\017\331\004\241\241\375\161\272\027\366\042\027\110\204\262"
	"\273\354\270\347\151\356\022\152\300\261\160\374\221\151\274\015"
	"\171\225\022\032\067\017\214\361\047\202\023\076\313\230\361\207"
	"\204\251\156\356\230\201\131\130\062\311\124\304\063\020\322\254"
	"\246\344\306\336\364\122\317\034\325\343\133\241\173\114\051\000"
	"\366\227\357\216\030\110\347\113\022\074\017\105\114\341\361\363"
	"\306\270\321\273\013\241\327\341\204\062\202\000\177\253\001\165"
	"\103\360\004\134\070\353\247\113\047\267\220\164\230\201\150\137"
	"\072\071\032\105\332\362\046\137\045\251\140\244\125\141\032\230"
	"\121\037\364\211\012\234\324\062\123\145\247\354\347\017\113\041"
	"\110\146\146\043\130\215\203\175\066\343\042\214\104\075\044\225"
	"\134\031\037\147\265\364\232\011\131\101\365\100\121\100\142\232"
	"\246\311\275\377\126\100\175\215\043\237\341\122\254\042\073\005"
	"\143\106\172\026\112\342\213\012\155\015\126\227\046\020\241\270"
	"\173\032\346\114\147\273\332\165\264\115\062\271\324\051\243\045"
	"\275\235\341\364\125\237\061\263\335\031\054\141\160\024\277\362"
	"\135\330\004\172\052\125\133\150\266\101\075\302\041\033\307\255"
	"\241\006\254\055\030\326\375\200\012\230\345\264\202\354\034\316"
	"\313\106\065\116\220\063\311\143\056\223\132\344\121\260\353\153"
	"\131\375\223\170\014\127\066\267\345\107\245\356\213\131\126\047"
	"\000\014\271\261\034\062\022\370\026\175\174\017\120\066\313\231"
	"\077\134\215\001\353\327\342\345\227\357\170\224\316\356\227\227"
	"\176\212\356\011\273\005\047\141\204\023\344\071\354\250\107\257"
	"\177\246\004\033\167\320\244\274\141\055\020\145\114\343\342\157"
	"\346\154\114\326\104\350\055\224\114\137\154\300\020\265\121\242"
	"\365\215\077\013\026\270\056\370\356\147\164\155\301\171\172\254"
	"\127\262\030\217\326\275\136\172\343\342\317\035\013\350\357\310"
	"\311\326\160\242\003\335\156\140\140\350\245\216\227\026\351\366"
	"\324\335\160\242\160\131\251\373\254\123\077\377\170\110\370\043"
	"\037\262\273\046\231\242\030\264\162\355\036\166\310\057\370\220"
	"\233\177\215\210\140\054\376\204\337\206\062\215\352\342\375\002"
	"\356\160\074\023\126\065\203\227\137\177\007\111\021\220\275\166"
	"\217\172\034\363\255\234\306\241\165\002\314\352\272\356\232\046"
	"\156\342\272\126\147\155\305\054\364\251\124\163\060\057\174\106"
	"\121\077\156\331\171\270\010\222\255\154\242\155\311\162\325\320"
	"\350\017\061\346\153\065\270\147\303\041\330\340\022\146\171\363"
	"\137\276\324\064\220\215\233\355\125\131\246\223\256\230\132\115"
	"\317\134\306\327\310\013\246\144\172\362\252\305\062\161\245\214"
	"\131\321\217\263\030\224\223\237\345\136\172\263\342\246\343\004"
	"\062\144\146\311\325\307\020\103\265\327\011\154\036\133\317\362"
	"\034\157\202\152\041\063\373\150\036\324\045\177\366\213\346\327"
	"\177\075\201\261\212\211\173\351\167\156\316\107\225\231\372\001"
	"\227\304\320\040\002\160\163\277\373\032\311\070\066\130\331\353"
	"\234\061\010\166\027\365\265\170\027\045\306\027\371\200\160\146"
	"\066\133\055\000\204\321\345\211\331\370\110\047\055\202\124\347"
	"\157\053\152\104\215\157\316\074\130\241\106\163\060\017\315\054"
	"\146\261\111\274\102\121\175\100\251\115\122\365\107\003\124\265"
	"\246\372\172\244\274\145\362\276\120\115\356\067\335\371\130\217"
	"\264\332\173\266\044\007\260\357\265\017\101\023\102\141\221\222"
	"\221\043\137\070\345\145\170\263\032\101\065\205\122\212\211\225"
	"\376\177\226\327\307\014\327\003\251\244\202\303\041\002\356\271"
	"\274\260\211\317\155\022\122\321\020\376\371\054\054\037\376\120"
	"\104\110\160\024\114\346\306\077\274\007\140\044\024\025\340\062"
	"\225\123\240\361\043\264\361\067\040\161\245\146\153\112\214\227"
	"\047\104\052\153\321\233\246\313\143\303\044\101\063\035\163\276"
	"\343\160\011\055\336\335\246\166\163\113\240\012\136\223\300\362"
	"\314\135\110\355\074\364\345\311\152\372\243\267\063\124\335\301"
	"\071\307\032\006\224\144\051\124\203\035\026\071\176\163\110\167"
	"\066\215\121\143\117\065\366\214\320\013\143\374\106\052\250\373"
	"\267\354\357\003\273\067\163\244\177\134\153\271\052\363\121\332"
	"\057\220\233\154\027\044\024\046\044\103\043\172\043\375\312\354"
	"\172\162\164\125\307\156\240\354\236\201\102\062\200\147\105\041"
	"\376\062\300\361\072\046\005\025\211\366\047\067\254\365\111\005"
	"\073\355\223\310\117\271\337\253\076\323\307\005\306\231\170\275"
	"\317\171\067\054\222\313\015\302\065\141\165\117\014\204\037\262"
	"\016\274\273\170\357\017\122\347\200\047\125\236\170\110\377\270"
	"\006\254\020\306\036\257\305\257\043\171\036\251\143\200\175\061"
	"\330\002\026\013\052\172\272\347\073\103\061\363\212\370\300\172"
	"\315\170\060\076\136\241\251\277\074\343\324\035\355\044\132\035"
	"\034\172\174\213\367\377\275\003\306\001\132\110\141\324\127\041"
	"\142\313\104\311\122\262\233\124\277\173\375\351\225\042\351\347"
	"\370\105\067\070\104\123\044\324\111\106\300\161\361\107\312\106"
	"\014\146\035\356\372\220\264\060\147\030\356\136\177\343\153\143"
	"\143\067\150\273\162\031\124\372\153\214\217\306\162\254\056\020"
	"\342\143\210\060\312\046\056\056\373\030\311\040\064\235\374\150"
	"\110\062\370\134\064\031\040\226\157\310\033\161\147\006\117\354"
	"\330\024\345\207\276\000\034\324\246\027\003\165\123\315\375\227"
	"\012\040\270\143\323\067\044\150\070\310\334\067\252\176\140\040"
	"\062\362\103\243\226\046\312\231\110\133\130\020\133\110\243\146"
	"\266\123\362\056\161\304\020\062\340\364\330\046\161\110\236\165"
	"\120\361\263\007\210\132\365\066\334\026\055\352\263\274\267\302"
	"\121\104\327\337\330\312\073\166\053\366\232\071\360\310\231\141"
	"\033\071\344\005\312\342\154\130\030\331\204\035\320\032\150\335"
	"\077\375\071\130\034\241\016\021\073\027\152\175\014\253\316\115"
	"\015\150\364\327\046\363\056\147\160\273\213\020\326\363\355\025"
	"\360\047\156\015\310\174\036\003\224\211\201\241\065\117\356\103"
	"\270\342\032\336\325\110\105\106\004\320\126\332\303\103\357\264"
	"\152\135\302\063\332\341\066\156\152\270\017\237\007\376\343\277"
	"\341\375\235\266\105\343\374\112\263\123\044\167\226\024\054\001"
	"\161\356\064\114\320\153\273\072\043\312\332\052\311\275\352\252"
	"\273\210\141\001\153\136\113\037\261\160\227\107\204\303\111\366"
	"\262\175\102\202\350\375\275\013\310\230\066\222\125\040\074\021"
	"\250\236\022\024\374\135\063\255\315\313\365\122\217\076\110\101"
	"\273\213\304\244\211\202\257\121\032\345\344\160\006\040\201\256"
	"\277\223\303\273\360\367\151\276\302\137\020\121\235\131\223\131"
	"\344\127\375\155\332\255\277\364\222\243\144\230\304\345\107\203"
	"\171\012\076\152\002\250\050\304\007\071\026\245\222"
#define      tst2_z	19
#define      tst2	((&data[2144]))
	"\001\374\344\333\344\203\166\237\247\255\246\052\302\025\004\353"
	"\131\004\237\217\240\021\234\252\243"
#define      date_z	1
#define      date	((&data[2165]))
	"\316"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
