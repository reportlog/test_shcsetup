#if 0
	shc Version 3.8.9b, Generic Script Compiler
	Copyright (c) 1994-2015 Francisco Rosales <frosal@fi.upm.es>

	./shc -f K99_updateReport 
#endif

static  char data [] = 
#define      rlax_z	1
#define      rlax	((&data[0]))
	"\225"
#define      opts_z	1
#define      opts	((&data[1]))
	"\340"
#define      date_z	1
#define      date	((&data[2]))
	"\347"
#define      shll_z	8
#define      shll	((&data[4]))
	"\233\231\227\126\315\046\031\107\250\170\211"
#define      text_z	758
#define      text	((&data[63]))
	"\242\027\252\107\217\256\363\207\216\021\311\273\263\176\040\154"
	"\056\070\161\140\244\154\234\037\153\070\230\365\375\332\041\237"
	"\362\314\347\201\172\333\011\011\354\322\305\240\120\345\014\176"
	"\036\155\327\157\226\114\317\310\377\030\154\074\163\006\141\213"
	"\365\330\077\225\226\120\141\013\214\224\045\102\325\205\030\313"
	"\222\014\317\144\121\133\252\056\141\036\367\267\366\006\357\121"
	"\107\114\035\123\254\252\020\142\351\306\200\271\356\235\241\041"
	"\342\360\246\177\005\035\017\212\320\023\334\124\117\014\205\120"
	"\210\223\224\104\176\344\072\017\102\060\361\002\044\111\333\017"
	"\175\223\226\313\361\313\266\075\123\351\215\064\210\144\076\370"
	"\375\054\154\015\317\302\252\041\213\115\326\275\205\314\110\126"
	"\217\131\104\203\342\223\334\172\372\042\372\320\070\044\174\305"
	"\063\304\356\122\225\204\006\215\351\232\376\031\000\305\273\225"
	"\356\324\335\051\155\345\277\007\236\053\320\350\320\071\377\000"
	"\232\155\075\040\054\031\036\356\050\130\261\351\043\054\135\326"
	"\236\172\074\060\030\375\213\157\342\151\030\237\305\157\175\016"
	"\040\077\316\120\147\011\127\022\164\167\366\306\116\036\367\174"
	"\054\025\367\060\121\132\236\244\106\173\043\131\365\062\067\344"
	"\154\120\176\141\315\115\021\331\251\333\331\167\272\214\007\147"
	"\156\344\164\063\015\276\242\132\141\334\262\155\235\044\276\315"
	"\145\301\007\334\315\354\257\253\064\215\016\075\271\275\170\221"
	"\015\351\166\130\113\066\164\077\257\020\106\172\234\212\343\023"
	"\010\057\352\204\302\236\156\151\103\367\377\004\072\116\140\040"
	"\215\355\336\306\142\222\057\041\212\003\101\003\261\323\217\147"
	"\154\324\267\305\337\337\215\070\025\324\370\107\336\250\145\115"
	"\203\332\100\331\326\320\100\165\133\112\051\354\343\045\162\202"
	"\061\224\250\377\050\276\151\231\125\112\153\326\163\004\176\234"
	"\164\006\073\167\346\345\226\021\010\337\201\244\066\222\110\016"
	"\026\326\214\171\041\340\357\350\152\140\324\226\152\153\373\324"
	"\373\241\267\117\335\226\333\323\002\106\173\331\366\234\132\153"
	"\246\116\006\006\210\200\004\107\265\224\324\314\101\321\175\206"
	"\244\023\355\260\216\337\163\046\330\044\101\377\211\171\233\301"
	"\254\310\026\313\051\077\272\233\372\274\300\005\115\273\201\047"
	"\072\145\364\176\360\376\266\327\306\057\302\135\252\335\302\375"
	"\165\252\211\057\264\220\367\071\256\361\227\347\016\134\107\100"
	"\132\060\063\125\276\275\263\057\263\007\211\201\026\055\236\340"
	"\170\146\211\213\036\250\312\076\370\204\136\052\144\056\305\226"
	"\070\004\264\366\266\272\356\037\362\334\104\151\306\175\141\123"
	"\352\223\000\375\201\244\217\060\336\266\007\042\370\210\212\066"
	"\322\372\142\075\121\121\304\166\301\340\264\234\300\305\314\225"
	"\113\242\242\120\224\226\235\307\251\223\264\205\052\251\071\122"
	"\224\061\246\225\311\104\345\336\214\236\040\127\004\307\003\040"
	"\356\123\177\306\004\352\224\327\051\033\035\073\214\130\126\141"
	"\167\216\211\025\311\052\351\213\223\051\164\100\352\334\302\357"
	"\360\346\352\240\136\171\247\276\256\214\053\213\064\300\026\224"
	"\053\237\332\335\366\257\375\172\322\343\060\303\111\233\144\232"
	"\151\375\005\171\233\363\021\025\246\262\170\075\052\256\252\170"
	"\226\353\304\265\372\010\370\032\104\372\340\301\223\267\313\010"
	"\314\242\010\160\257\214\315\306\145\153\022\217\071\217\204\117"
	"\140\365\146\342\105\303\222\220\223\037\067\073\012\226\101\177"
	"\271\272\323\021\051\136\034\175\337\302\352\173\342\125\263\172"
	"\112\261\125\154\121\107\070\071\311\263\024\322\274\000\245\201"
	"\240\365\147\255\164\205\053"
#define      inlo_z	3
#define      inlo	((&data[853]))
	"\104\226\371"
#define      tst2_z	19
#define      tst2	((&data[856]))
	"\210\307\264\333\320\161\056\230\364\334\267\067\261\151\065\322"
	"\123\003\252\202\245"
#define      chk2_z	19
#define      chk2	((&data[878]))
	"\042\242\206\071\203\140\353\105\143\004\126\035\250\332\307\132"
	"\254\272\147\073\205\102\132\276"
#define      pswd_z	256
#define      pswd	((&data[904]))
	"\336\312\323\057\343\034\155\203\243\100\277\376\220\112\232\341"
	"\043\205\112\271\140\146\160\366\200\225\017\366\112\033\371\101"
	"\103\154\161\047\211\336\252\055\037\152\053\260\264\306\221\327"
	"\114\334\221\254\102\002\243\303\227\263\271\341\316\262\043\022"
	"\037\224\072\251\163\344\326\223\116\001\104\003\310\326\332\024"
	"\262\153\300\364\155\144\267\004\030\161\346\347\044\012\371\104"
	"\237\063\355\023\030\303\247\146\305\353\151\215\301\104\241\163"
	"\260\142\150\035\307\040\042\337\221\011\306\266\024\300\372\264"
	"\364\347\307\014\253\157\163\161\132\335\376\034\041\240\217\321"
	"\003\370\357\312\030\022\251\252\034\160\140\060\060\132\345\044"
	"\102\255\060\356\034\244\137\167\201\136\223\242\376\043\164\001"
	"\033\144\314\063\166\166\335\223\346\076\303\027\231\251\074\333"
	"\126\155\312\162\021\051\351\222\207\174\065\206\237\252\210\273"
	"\016\124\356\205\313\314\030\262\012\334\311\243\205\005\177\333"
	"\162\111\115\203\163\067\026\373\263\114\201\123\366\012\016\004"
	"\137\375\211\052\312\242\334\324\176\245\170\004\253\367\337\036"
	"\101\055\242\203\113\164\171\262\042\355\070\116\100\200\143\017"
	"\252\317\222\117\205\307\112\247\115\215\002\013\231\020\336\167"
	"\332\262\373\046\047\164\330\111\142\021\227\242\221\373\262\073"
	"\312\105\213\117\014\326\367\131"
#define      xecc_z	15
#define      xecc	((&data[1216]))
	"\375\012\104\142\333\237\012\011\323\344\227\254\154\177\346\164"
	"\106\363\165"
#define      msg1_z	42
#define      msg1	((&data[1242]))
	"\012\035\345\343\147\107\364\376\352\205\373\332\065\146\312\304"
	"\353\365\346\257\131\330\236\374\010\025\372\267\211\121\115\024"
	"\051\337\005\172\375\070\241\136\371\164\302\002\310\270\153\234"
	"\152\113\241\103\371\234\301\304"
#define      lsto_z	1
#define      lsto	((&data[1288]))
	"\247"
#define      tst1_z	22
#define      tst1	((&data[1289]))
	"\017\277\202\064\251\164\123\252\270\000\150\020\166\351\145\274"
	"\127\043\336\266\203\022"
#define      chk1_z	22
#define      chk1	((&data[1314]))
	"\254\205\017\036\114\305\303\313\263\336\152\261\057\043\342\377"
	"\075\370\365\122\044\132\016\313\142"
#define      msg2_z	19
#define      msg2	((&data[1340]))
	"\347\153\376\005\225\137\323\060\002\233\031\236\026\310\132\065"
	"\103\021\127\071\024\034\322\121\342\154\230"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
