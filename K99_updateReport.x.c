#if 0
	shc Version 3.8.9b, Generic Script Compiler
	Copyright (c) 1994-2015 Francisco Rosales <frosal@fi.upm.es>

	./shc -e 31/12/2222 -r -f K99_updateReport 
#endif

static  char data [] = 
#define      msg1_z	42
#define      msg1	((&data[0]))
	"\307\370\063\211\343\253\262\144\123\217\267\373\000\121\213\140"
	"\355\326\002\110\137\142\252\343\024\130\265\056\036\343\241\164"
	"\053\035\126\177\306\063\235\376\353\154\144\100\270\073\206\316"
	"\040\253\261\301"
#define      shll_z	8
#define      shll	((&data[53]))
	"\241\364\040\351\101\167\047\271\276\015\047"
#define      chk2_z	19
#define      chk2	((&data[64]))
	"\244\221\115\262\162\075\123\037\364\371\240\164\011\275\361\333"
	"\221\014\034\122\051\353\102"
#define      pswd_z	256
#define      pswd	((&data[146]))
	"\217\173\051\241\157\215\342\047\310\150\366\350\024\247\252\110"
	"\114\152\351\131\222\342\243\111\207\314\064\312\304\044\341\123"
	"\237\012\365\017\227\327\066\137\100\055\110\124\324\362\235\041"
	"\135\207\173\360\151\036\071\361\352\156\273\256\264\231\334\200"
	"\076\313\164\343\327\117\306\226\247\133\214\156\156\214\146\324"
	"\337\202\011\311\254\127\156\007\307\100\234\174\331\171\374\030"
	"\104\160\373\034\300\301\262\147\035\076\326\213\313\074\140\252"
	"\277\151\164\153\301\343\162\211\043\017\005\375\210\001\025\315"
	"\162\020\351\062\322\234\232\357\332\161\172\246\256\332\120\155"
	"\104\305\331\005\251\114\217\314\133\224\311\344\226\336\262\010"
	"\357\233\072\301\067\325\261\022\106\053\270\364\006\011\142\112"
	"\317\073\120\170\207\337\105\343\164\016\310\012\355\172\022\335"
	"\026\115\237\116\042\120\141\151\173\031\135\202\043\300\314\363"
	"\373\035\153\203\374\261\147\160\277\057\172\255\252\215\213\300"
	"\333\052\016\375\172\157\147\366\211\305\171\255\205\105\240\201"
	"\142\014\004\137\275\154\320\175\233\113\053\105\330\266\006\263"
	"\341\024\261\133\204\031\122\016\336\313\273\143\021\134\344\164"
	"\151\351\323\047\125\243\245\361\357\320\066\307\207\075\173\150"
	"\122\055\304\326\106\026\345\044\342\241\210\363\376\155\150\147"
	"\126\073\217\254\337\064\235\317\004\324\226\213\222\234\002\062"
	"\246"
#define      date_z	11
#define      date	((&data[407]))
	"\051\242\135\131\331\324\147\363\110\131\067"
#define      text_z	1099
#define      text	((&data[547]))
	"\020\246\345\144\172\327\002\234\065\211\027\045\362\066\137\343"
	"\040\315\236\317\140\073\322\223\341\312\325\037\232\116\275\252"
	"\364\242\017\157\172\021\013\257\232\043\325\215\131\064\161\172"
	"\001\020\111\142\113\033\365\055\345\312\115\200\030\012\052\014"
	"\255\071\174\047\113\210\327\346\253\254\163\005\340\345\177\342"
	"\366\310\104\102\344\071\157\312\004\275\112\034\310\165\051\165"
	"\256\245\235\372\055\165\340\331\041\124\336\002\071\135\345\057"
	"\046\051\161\013\143\341\325\147\236\040\204\147\225\255\334\104"
	"\123\344\361\011\304\153\030\067\050\276\024\276\220\143\364\375"
	"\323\206\067\046\242\377\041\255\271\103\167\160\155\325\101\307"
	"\155\211\043\007\342\320\165\127\220\305\017\177\241\136\154\074"
	"\033\117\362\120\137\250\051\341\236\343\325\035\340\064\170\001"
	"\343\340\255\122\257\100\175\264\003\066\054\276\056\357\053\016"
	"\121\044\145\133\055\036\103\120\316\304\306\152\106\210\255\053"
	"\057\116\367\115\105\101\276\110\214\343\140\123\350\161\200\277"
	"\352\074\222\240\277\303\060\176\272\321\342\207\102\303\155\361"
	"\232\263\375\364\242\363\211\207\047\261\235\351\270\005\143\347"
	"\330\147\311\012\060\051\004\133\117\125\150\213\112\316\163\025"
	"\175\255\064\166\373\376\120\161\103\345\211\247\203\152\073\162"
	"\364\355\203\036\253\367\107\005\000\036\201\326\233\152\334\276"
	"\247\276\360\275\223\271\230\136\255\172\107\160\353\171\117\146"
	"\046\276\310\151\123\042\200\301\254\341\261\040\316\161\250\021"
	"\322\061\357\014\027\127\244\173\175\320\337\062\051\167\026\124"
	"\276\377\304\302\036\021\265\342\252\224\202\240\277\120\170\340"
	"\256\333\136\073\142\010\227\035\344\142\024\212\333\071\135\216"
	"\323\220\370\154\312\204\055\336\357\377\274\315\326\040\251\271"
	"\112\042\060\305\222\073\020\065\175\143\233\104\253\201\023\065"
	"\016\131\232\043\301\052\031\156\343\255\161\146\153\321\025\026"
	"\214\034\211\020\035\177\105\166\164\215\140\313\345\306\060\007"
	"\157\152\052\377\275\204\071\340\000\200\350\305\375\040\143\117"
	"\162\061\037\337\164\042\167\141\125\040\124\013\337\017\260\222"
	"\303\317\215\211\101\154\337\100\044\105\251\172\222\074\045\326"
	"\344\344\202\123\352\210\325\246\110\154\244\067\316\214\327\110"
	"\071\063\114\363\207\317\261\056\367\172\146\155\303\050\014\163"
	"\042\347\172\001\372\023\345\105\025\146\030\315\266\265\246\315"
	"\367\066\206\113\011\104\135\322\351\275\150\002\022\166\106\173"
	"\173\104\330\110\254\323\277\010\032\167\045\004\273\000\376\366"
	"\312\142\153\363\347\244\253\050\077\234\076\370\216\240\003\355"
	"\172\345\114\064\240\342\152\127\133\001\344\233\217\000\343\166"
	"\301\147\343\251\220\214\002\146\311\061\231\151\055\014\100\234"
	"\042\172\014\106\104\351\243\334\367\144\006\064\014\104\075\047"
	"\035\215\137\015\025\360\270\073\317\153\376\240\002\325\310\355"
	"\072\067\010\101\257\135\347\265\036\176\210\350\302\007\104\103"
	"\240\341\141\137\242\353\310\264\111\172\012\330\026\062\072\241"
	"\117\014\217\173\332\004\167\201\042\203\372\206\256\266\232\363"
	"\045\127\352\346\354\034\251\351\046\273\150\150\240\202\100\070"
	"\236\352\106\321\232\320\106\112\026\356\306\005\071\331\277\171"
	"\141\372\004\067\330\105\334\326\243\145\221\372\236\022\251\355"
	"\363\363\035\153\033\302\071\072\114\161\224\212\156\124\375\033"
	"\225\172\162\344\067\264\313\016\042\307\233\231\233\330\303\330"
	"\334\115\044\044\172\302\247\311\235\010\171\276\054\345\160\276"
	"\376\135\000\037\357\340\261\336\210\043\117\176\013\201\320\217"
	"\120\206\214\173\037\373\040\164\074\026\363\067\324\272\202\061"
	"\245\041\130\103\375\272\103\114\013\026\004\057\014\046\122\025"
	"\044\274\102\330\034\343\337\257\064\235\361\176\271\311\204\151"
	"\046\306\004\014\145\052\372\205\050\071\103\036\077\104\151\323"
	"\270\057\271\100\004\053\354\044\111\201\213\047\254\333\334\356"
	"\374\011\310\374\225\371\061\221\272\020\145\331\053\043\104\215"
	"\067\053\073\172\102\036\115\007\323\163\145\140\350\173\025\072"
	"\332\057\026\135\304\215\002\350\247\235\343\355\076\255\320\055"
	"\002\013\346\256\154\162\237\305\270\347\365\013\272\137\060\072"
	"\320\145\112\162\273\032\162\235\135\106\122\341\310\243\373\271"
	"\224\352\176\005\027\375\303\164\066\075\041\216\120\030\245\104"
	"\250\015\240\035\353\013\240\354\026\041\017\142\300\143\052\007"
	"\050\376\170\017\250\160\167\031\072\262\110\117\304\250\060\151"
	"\363\015\005\146\204\314\377\157\002\215\021\074\214\053\051\252"
	"\177\204\045\075\246\267\016\163\130\070\013\214\203\240\004\051"
	"\073\337\346\072\334\133\335\201\101\014\232\354\242\141\072\176"
	"\312\214\035\147\363\330\345\142\325\066\274\002\131\325\257\175"
	"\016\130\025\236\117\155\104\371\243\206\122\346\110\115\146\250"
	"\251\264\347\362\231\344\264\323\113\076\237\270\067\246\153\145"
	"\225\150\322\150\250\027\306\232\225\115\203\277\017\376\126\303"
	"\154\162\020\321\040\324\235\271\332\245\031\212\274\063\160\256"
	"\151\133\146\074\204\002\056\357\325\343\162\153\165\267\365\232"
	"\351\074\037\063\102\231\220\112\252\161\135\132\320\315\246\316"
	"\047\132\357\111\354\115\237\305\142\143\151\243\324\110\275\234"
	"\302\217\224\034\172\157\152\034\351\320\367\013\172\076\201\357"
	"\036\132\021\162\071\024\254\227\371\333\275\043\115\311\206\056"
	"\237\356\315\277\162\065\124\037\021\231\163\214\327\364\173\366"
	"\117\215\150\210\241\024\037\233\360\335\276\075\246\105\154\105"
	"\063\072\005\245\157\132\305\201\363\070\015\313\054\211\301\174"
	"\027\052\004\270\076\044\124\057\002\022\155\251\130\332\356\213"
	"\024\364\060\204\116\366\005\102\056\023\015\133\235\317\327\264"
	"\371\334\155\070\001\301\147\003\324\325\254\054\257\233\267\303"
	"\217\350\110\336\336\116\040\015\141\056\150\376\375\100\263\366"
	"\034\040\056\035\341\226\040\265\153\315\342\032\150\231\336\367"
	"\202\046\326\141\164\367\156\326\045\326\325\042\026\210\031\063"
	"\251\110\121\212\336"
#define      lsto_z	1
#define      lsto	((&data[1815]))
	"\020"
#define      inlo_z	3
#define      inlo	((&data[1816]))
	"\370\235\320"
#define      msg2_z	19
#define      msg2	((&data[1822]))
	"\237\077\152\070\232\101\363\144\157\160\166\313\021\032\277\025"
	"\164\231\340\011\160\052\165"
#define      rlax_z	1
#define      rlax	((&data[1842]))
	"\071"
#define      xecc_z	15
#define      xecc	((&data[1845]))
	"\346\213\043\217\061\271\372\025\071\203\377\217\305\124\312\342"
	"\001\264\375"
#define      tst1_z	22
#define      tst1	((&data[1866]))
	"\274\026\201\107\240\346\116\211\213\065\050\142\235\124\351\326"
	"\071\321\303\102\116\160\022\210\034\023\365"
#define      chk1_z	22
#define      chk1	((&data[1892]))
	"\062\253\245\175\262\200\363\162\342\211\313\263\267\173\254\147"
	"\204\262\161\007\310\025\224\064\307\331"
#define      opts_z	1
#define      opts	((&data[1915]))
	"\277"
#define      tst2_z	19
#define      tst2	((&data[1917]))
	"\110\045\203\063\347\155\200\000\156\250\360\272\070\245\052\173"
	"\110\000\162\005\062\132\127\350"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
